<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>DontForget</title>
    <!doctype html>
    <html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Toâ€‘Do Lists â€” Mobileâ€‘First with Pointer DnD & Dark Mode</title>
        <style>
            :root {
                --bg: #f2f4fb;
                --card: #ffffff;
                --muted: #6b7280;
                --accent: #5b46f5;
                --danger: #ef4444;
                --text: #0f172a;
                --task-text: #0f172a;
                --radius: 14px;
                --shadow: 0 8px 28px rgba(15, 23, 42, 0.06);
                font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            }

            :root.dark {
                --bg: #0f1220;
                --card: #13162a;
                --muted: #a5b4cf;
                --accent: #7c6aff;
                --danger: #ff6b6b;
                --text: #e5e7f3;
                --task-text: #000000;
                --shadow: 0 8px 28px rgba(0, 0, 0, 0.35);
            }

            * {
                box-sizing: border-box;
                -webkit-tap-highlight-color: transparent
            }

            html,
            body {
                height: 100%
            }

            body {
                margin: 0;
                background: var(--bg);
                color: var(--text);
            }

            /* Header */
            .topbar {
                position: sticky;
                top: 0;
                z-index: 40;
                display: flex;
                align-items: center;
                gap: 12px;
                justify-content: space-between;
                padding: 14px 16px;
                background: var(--bg);
                backdrop-filter: saturate(180%) blur(4px)
            }

            .topbar .left {
                display: flex;
                align-items: center;
                gap: 10px
            }

            .icon-btn {
                appearance: none;
                border: 1px solid rgba(15, 23, 42, 0.08);
                background: var(--card);
                color: var(--text);
                border-radius: 12px;
                padding: 8px 10px;
                cursor: pointer;
                box-shadow: var(--shadow)
            }

            .icon-btn.primary {
                background: var(--accent);
                color: #fff;
                border: none
            }

            /* Hide hamburger on desktop */
            .hamburger-btn {
                display: inline-block
            }

            #renameListBtn,
            #deleteListBtn,
            #exportBtn {
                color: var(--muted);
                cursor: pointer;
                font-size: 12px;
                font-weight: 600;

            }

            @media (min-width:900px) {
                .hamburger-btn {
                    display: none
                }
            }

            /* Layout: mobile-first single column */
            .app {
                max-width: 1100px;
                margin: 0 auto;
                display: grid;
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 16px
            }

            @media (min-width:900px) {
                .app {
                    grid-template-columns: 260px 1fr
                }
            }

            .panel {
                background: var(--card);
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                padding: 16px
            }

            /* Sidebar (drawer on mobile) */
            .sidebar {
                position: fixed;
                inset: 0 auto 0 0;
                width: 88vw;
                max-width: 320px;
                transform: translateX(-100%);
                transition: transform .25s ease;
                z-index: 50;
                background: var(--card);
                box-shadow: var(--shadow);
                border-radius: 0 16px 16px 0;
                display: flex;
                flex-direction: column
            }

            .sidebar.open {
                transform: translateX(0)
            }

            .sidebar .sidebar-inner {
                padding: 16px;
                height: 100%;
                display: flex;
                flex-direction: column
            }

            .overlay {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, .35);
                backdrop-filter: blur(2px);
                display: none;
                z-index: 45
            }

            .overlay.show {
                display: block
            }

            @media (min-width:900px) {
                .overlay {
                    display: none !important
                }

                .sidebar {
                    position: static;
                    transform: none;
                    width: auto;
                    max-width: none;
                    border-radius: var(--radius)
                }

                .sidebar .sidebar-inner {
                    padding: 16px
                }
            }

            .sidebar-head {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px
            }

            .title-strong {
                font-weight: 700;
                font-size: 16px
            }

            .btn {
                background: transparent;
                border: 1px solid rgba(15, 23, 42, 0.06);
                padding: 10px 12px;
                border-radius: 12px;
                cursor: pointer;
                font-weight: 600;
                color: var(--text)
            }

            .btn.primary {
                background: var(--accent);
                color: white;
                border: none
            }

            .lists {
                display: flex;
                flex-direction: column;
                gap: 10px;
                overflow: auto;
                -webkit-overflow-scrolling: touch
            }

            .list-row {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px;
                border-radius: 12px;
                cursor: grab;
                transition: transform .15s ease, box-shadow .15s ease, background .15s ease
            }

            .list-row:hover {
                transform: translateY(-2px)
            }

            .list-row.active {
                background: linear-gradient(90deg, #f3f4ff20, #fbfaff20);
                box-shadow: 0 6px 18px rgba(79, 70, 229, 0.08)
            }

            .list-name {
                font-weight: 600
            }

            .list-count {
                font-size: 13px;
                color: var(--muted)
            }

            .sidebar-actions {
                display: flex;
                gap: 8px;
                margin-top: 14px
            }

            @media (min-width:900px) {
                .sidebar-actions {
                    display: flex
                }
            }

            .more-menu {
                position: relative
            }

            .menu {
                position: absolute;
                top: 110%;
                background: var(--card);
                border: 1px solid rgba(15, 23, 42, 0.08);
                border-radius: 12px;
                box-shadow: var(--shadow);
                display: none;
                min-width: 160px
            }

            .menu.open {
                display: block
            }

            .menu button {
                width: 100%;
                text-align: left;
                padding: 10px 12px;
                border: 0;
                background: transparent;
                cursor: pointer
            }

            /* Main board */
            .board {
                min-height: 50vh
            }

            .board-head {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 14px
            }

            .board-title {
                font-size: 22px;
                margin: 0;
                font-weight: 800
            }

            #taskCount {
                margin-left: auto;
                color: var(--muted);
                font-weight: 600
            }

            .add-task {
                display: flex;
                gap: 10px;
                margin-bottom: 14px
            }

            .add-task input {
                flex: 1;
                padding: 14px;
                border-radius: 12px;
                border: 1px solid #eef2ff;
                background: #fbfdff;
                color: var(--task-text)
            }

            .add-task .btn {
                padding: 10px 14px;
                border-radius: 12px
            }

            .tasks {
                display: flex;
                flex-direction: column;
                gap: 10px
            }

            .task {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 14px;
                border-radius: 12px;
                border: 1px solid #f1f3fa;
                background: #fff;
                color: var(--task-text);
                transition: transform .15s ease, box-shadow .15s ease, opacity .12s ease;
                touch-action: none;
                cursor: grab
            }

            .task .text {
                flex: 1;
                font-size: 16px;
                color: var(--task-text)
            }

            .task .actions {
                display: flex;
                gap: 8px
            }

            .small-btn {
                padding: 8px 10px;
                border-radius: 10px;
                border: 1px solid #eee;
                background: #fff;
                color: var(--task-text);
                cursor: pointer
            }

            /* drag styles */
            .dragging {
                opacity: .85;
                transform: scale(.995);
                box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12)
            }

            .drop-indicator {
                height: 10px;
                margin: 2px 0;
                border-radius: 6px;
                background: rgba(91, 70, 245, 0.25);
                display: none
            }

            .drop-indicator.show {
                display: block
            }

            .empty {
                padding: 20px;
                text-align: center;
                color: var(--muted)
            }

            /* Desktop overrides: show inline actions, hide hamburger */
            @media (min-width:900px) {
                #openSidebar {
                    display: none;
                }

                /* turn kebab menu into inline buttons */
                .more-menu #moreBtn {
                    display: none;
                }

                .more-menu .menu {
                    position: static;
                    display: flex !important;
                    gap: 8px;
                    border: none;
                    box-shadow: none;
                    background: transparent;
                    min-width: unset;
                    top: auto;
                    right: auto
                }

                .more-menu .menu button {
                    width: auto;
                    text-align: center;
                    border: 1px solid rgba(15, 23, 42, 0.06);
                    border-radius: 12px;
                    background: var(--card)
                }
            }
        </style>
    </head>

<body>
    <!-- rest of the HTML unchanged -->
</body>

</html>

</head>

<body>
    <header class="topbar">
        <div class="left">
            <button id="openSidebar" class="icon-btn" aria-label="Open lists">â˜°</button>
            <strong>Toâ€‘Do</strong>
        </div>
        <div class="right">
            <button id="darkToggle" class="icon-btn" aria-label="Toggle dark mode">ðŸŒ™</button>
        </div>
    </header>

    <div class="app">
        <!-- Sidebar as drawer on mobile, panel on desktop -->
        <aside class="sidebar panel" id="sidebar">
            <div class="sidebar-inner">
                <div class="sidebar-head">
                    <div class="title-strong">Lists</div>
                    <button id="newListBtn" class="btn">ï¼‹ New</button>
                </div>

                <div class="lists" id="listsContainer"></div>

                <div class="sidebar-actions">
                    <div class="more-menu">
                        <button id="moreBtn" class="btn">â‹®</button>
                        <div id="moreMenu" class="menu">
                            <button id="renameListBtn">Rename</button>
                            <button id="deleteListBtn">Delete</button>
                            <button id="exportBtn">Export</button>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        <div class="overlay" id="overlay"></div>

        <main class="panel board" aria-label="Tasks">
            <header class="board-head">
                <h2 id="listTitle" class="board-title">(no list)</h2>
                <div id="taskCount">0 tasks</div>
            </header>

            <div class="add-task">
                <input id="taskInput" type="text" placeholder="Add a new task and press Enter" aria-label="New task" />
                <button id="addTaskBtn" class="btn primary">Add</button>
            </div>

            <div class="drop-indicator" id="taskDropIndicator"></div>
            <div class="tasks" id="tasksContainer"></div>

            <div id="emptyState" class="empty">Create a list to get started â€” tap "New" above.</div>
        </main>
    </div>

    <script>
        // === State & storage ===
        const STORAGE_KEY = 'todo_lists_v1';
        const THEME_KEY = 'todo_theme_v1';
        const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2, 7);

        let state = { lists: [], activeId: null };

        // === Elements ===
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const openSidebarBtn = document.getElementById('openSidebar');
        const darkToggle = document.getElementById('darkToggle');

        const listsContainer = document.getElementById('listsContainer');
        const listTitle = document.getElementById('listTitle');
        const taskInput = document.getElementById('taskInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const tasksContainer = document.getElementById('tasksContainer');
        const newListBtn = document.getElementById('newListBtn');
        const renameListBtn = document.getElementById('renameListBtn');
        const deleteListBtn = document.getElementById('deleteListBtn');
        const exportBtn = document.getElementById('exportBtn');
        const emptyState = document.getElementById('emptyState');
        const taskCount = document.getElementById('taskCount');
        const moreBtn = document.getElementById('moreBtn');
        const moreMenu = document.getElementById('moreMenu');
        const taskDropIndicator = document.getElementById('taskDropIndicator');

        // === Theme ===
        const applyTheme = (mode) => {
            const root = document.documentElement;
            if (mode === 'dark') { root.classList.add('dark'); darkToggle.textContent = 'â˜€ï¸'; }
            else { root.classList.remove('dark'); darkToggle.textContent = 'ðŸŒ™'; }
            localStorage.setItem(THEME_KEY, mode);
        };
        applyTheme(localStorage.getItem(THEME_KEY) || 'light');
        darkToggle.addEventListener('click', () => {
            const next = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
            applyTheme(next);
        });

        // === Drawer controls (mobile) ===
        const openDrawer = () => { sidebar.classList.add('open'); overlay.classList.add('show'); };
        const closeDrawer = () => { sidebar.classList.remove('open'); overlay.classList.remove('show'); };
        openSidebarBtn.addEventListener('click', openDrawer);
        overlay.addEventListener('click', closeDrawer);

        // Kebab menu
        moreBtn.addEventListener('click', (e) => { e.stopPropagation(); moreMenu.classList.toggle('open'); });
        document.addEventListener('click', () => moreMenu.classList.remove('open'));

        // === Storage helpers ===
        const saveNow = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        const debounce = (fn, ms = 120) => { let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); }; };
        const save = debounce(saveNow, 120);

        function load() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (raw) state = JSON.parse(raw);
            } catch (e) { console.error('load failed', e); }
            state.lists = state.lists || [];
            if (!state.activeId && state.lists.length) state.activeId = state.lists[0].id;
        }

        // === Rendering lists (left) ===
        function renderLists() {
            listsContainer.innerHTML = '';
            state.lists.forEach(list => {
                const row = document.createElement('div');
                row.className = 'list-row' + (state.activeId === list.id ? ' active' : '');
                row.dataset.id = list.id;
                row.setAttribute('role', 'button');

                const name = document.createElement('div'); name.className = 'list-name'; name.textContent = list.title;
                const count = document.createElement('div'); count.className = 'list-count'; count.textContent = list.tasks.length;
                row.appendChild(name); row.appendChild(count);

                // tap to activate
                row.addEventListener('click', () => { state.activeId = list.id; save(); renderLists(); closeDrawer(); });

                // Pointer drag for list reordering
                enablePointerSort(row, listsContainer, {
                    onCommit: (fromEl, toIndex) => {
                        const fromId = fromEl.dataset.id;
                        const fromIdx0 = state.lists.findIndex(l => l.id === fromId);
                        if (fromIdx0 < 0) return;
                        const [moved] = state.lists.splice(fromIdx0, 1);
                        state.lists.splice(toIndex, 0, moved);
                        state.activeId = moved.id;
                        save(); renderLists();
                    }
                });

                listsContainer.appendChild(row);
            });

            emptyState.style.display = state.lists.length ? 'none' : '';
            renderActiveList();
        }

        // === Rendering tasks (right) ===
        function renderActiveList() {
            const list = state.lists.find(l => l.id === state.activeId);
            if (!list) { listTitle.textContent = '(no list)'; tasksContainer.innerHTML = ''; taskCount.textContent = '0 tasks'; return; }
            listTitle.textContent = list.title;
            taskCount.textContent = `${list.tasks.length} task${list.tasks.length !== 1 ? 's' : ''}`;

            tasksContainer.innerHTML = '';
            if (list.tasks.length === 0) { tasksContainer.innerHTML = '<div class="empty">No tasks yet â€” add one above.</div>'; return; }

            list.tasks.forEach(task => {
                const el = document.createElement('div'); el.className = 'task'; el.dataset.taskId = task.id;

                const checkbox = document.createElement('input'); checkbox.type = 'checkbox'; checkbox.checked = !!task.done; checkbox.addEventListener('change', () => { task.done = checkbox.checked; save(); renderLists(); });
                const txt = document.createElement('div'); txt.className = 'text'; txt.textContent = task.text; if (task.done) txt.style.textDecoration = 'line-through';

                const actions = document.createElement('div'); actions.className = 'actions';
                const edit = document.createElement('button'); edit.className = 'small-btn'; edit.textContent = 'Edit'; edit.addEventListener('click', () => startEditTask(list.id, task.id));
                const del = document.createElement('button'); del.className = 'small-btn'; del.textContent = 'Delete'; del.addEventListener('click', () => { if (confirm('Delete this task?')) { list.tasks = list.tasks.filter(t => t.id !== task.id); save(); renderLists(); } });
                actions.appendChild(edit); actions.appendChild(del);

                el.appendChild(checkbox); el.appendChild(txt); el.appendChild(actions);

                // Pointer drag for task sorting
                enablePointerSort(el, tasksContainer, {
                    onCommit: (fromEl, toIndex) => {
                        const fromId = fromEl.dataset.taskId;
                        const fromIdx0 = list.tasks.findIndex(t => t.id === fromId);
                        if (fromIdx0 < 0) return;
                        const [moved] = list.tasks.splice(fromIdx0, 1);
                        list.tasks.splice(toIndex, 0, moved);
                        save(); renderLists();
                    },
                    indicator: taskDropIndicator
                });

                tasksContainer.appendChild(el);
            });
        }

        // === Inline task edit ===
        function startEditTask(listId, taskId) {
            const list = state.lists.find(l => l.id === listId); if (!list) return; const task = list.tasks.find(t => t.id === taskId); if (!task) return;
            const taskEl = [...tasksContainer.children].find(n => n.dataset.taskId === taskId); if (!taskEl) return;
            const textNode = taskEl.querySelector('.text'); const old = task.text;
            const input = document.createElement('input'); input.type = 'text'; input.value = old; input.style.width = '100%'; input.style.padding = '10px'; input.style.borderRadius = '10px';
            textNode.replaceWith(input); input.focus(); input.select();
            input.addEventListener('blur', () => { const val = input.value.trim(); if (val) task.text = val; save(); renderLists(); });
            input.addEventListener('keydown', (e) => { if (e.key === 'Enter') input.blur(); if (e.key === 'Escape') { input.value = old; input.blur(); } });
        }

        // === Actions ===
        newListBtn.addEventListener('click', () => {
            const title = prompt('List name:', 'New list'); if (!title) return;
            const l = { id: uid(), title, tasks: [] };
            state.lists.push(l); state.activeId = l.id; save(); renderLists();
        });

        renameListBtn.addEventListener('click', () => {
            const list = state.lists.find(l => l.id === state.activeId); if (!list) return alert('No list selected');
            const title = prompt('Rename list:', list.title); if (!title) return; list.title = title; save(); renderLists();
        });

        deleteListBtn.addEventListener('click', () => {
            if (!state.activeId) return alert('No list selected');
            const list = state.lists.find(l => l.id === state.activeId); if (!list) return;
            if (!confirm(`Delete list "${list.title}" and all its tasks?`)) return;
            state.lists = state.lists.filter(l => l.id !== state.activeId);
            state.activeId = state.lists.length ? state.lists[0].id : null;
            save(); renderLists();
        });

        exportBtn.addEventListener('click', () => {
            const dataStr = JSON.stringify(state, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'todo-lists-export.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        });

        addTaskBtn.addEventListener('click', addTaskFromInput);
        taskInput.addEventListener('keydown', e => { if (e.key === 'Enter') addTaskFromInput(); });

        function addTaskFromInput() {
            const text = taskInput.value.trim(); if (!text) return; const list = state.lists.find(l => l.id === state.activeId);
            if (!list) { alert('Create a list first.'); return; }
            list.tasks.push({ id: uid(), text, done: false }); taskInput.value = ''; save(); renderLists();
        }

        // keyboard shortcut
        document.addEventListener('keydown', e => { if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n') { e.preventDefault(); newListBtn.click(); } });

        // === Pointer-based sortable helper (mouse + touch) ===
        function enablePointerSort(handleEl, containerEl, opts) {
            let startY = 0, dragging = false, ghostEl = null, placeholderIndex = -1, startIndex = -1;
            const indicator = opts?.indicator;

            const onPointerDown = (e) => {
                const isPrimary = e.isPrimary !== false;
                if (!isPrimary) return;
                // don't start drag on interactive controls
                if (e.target.closest('button, input, textarea, a, select')) return;
                handleEl.setPointerCapture?.(e.pointerId);
                startY = e.clientY || (e.touches?.[0]?.clientY);
                dragging = true;
                handleEl.classList.add('dragging');
                startIndex = [...containerEl.children].indexOf(handleEl);
                // ghost clone for smoother dragging feedback (visual only)
                ghostEl = handleEl.cloneNode(true);
                ghostEl.style.position = 'fixed'; ghostEl.style.left = handleEl.getBoundingClientRect().left + 'px';
                ghostEl.style.top = handleEl.getBoundingClientRect().top + 'px';
                ghostEl.style.width = handleEl.getBoundingClientRect().width + 'px';
                ghostEl.style.pointerEvents = 'none'; ghostEl.style.opacity = '0.9'; ghostEl.style.zIndex = '1000';
                ghostEl.classList.add('dragging');
                document.body.appendChild(ghostEl);
            };

            const onPointerMove = (e) => {
                if (!dragging) return;
                const y = e.clientY ?? (e.touches?.[0]?.clientY);
                if (y == null) return;
                // move ghost
                const dy = y - startY;
                const rect = handleEl.getBoundingClientRect();
                ghostEl.style.transform = `translateY(${dy}px)`;

                // compute index by midpoint comparison
                const siblings = [...containerEl.children].filter(n => n !== ghostEl);
                const positions = siblings.map(n => ({ el: n, rect: n.getBoundingClientRect(), mid: n.getBoundingClientRect().top + n.getBoundingClientRect().height / 2 }));
                let newIndex = positions.findIndex(p => y < p.mid);
                if (newIndex === -1) newIndex = siblings.length; // append
                placeholderIndex = newIndex;

                // show indicator row if provided
                if (indicator) {
                    indicator.classList.add('show');
                    const refEl = siblings[newIndex];
                    if (refEl) { containerEl.insertBefore(indicator, refEl); }
                    else { containerEl.appendChild(indicator); }
                }
            };

            const onPointerUp = () => {
                if (!dragging) return;
                dragging = false;
                handleEl.classList.remove('dragging');
                ghostEl?.remove(); ghostEl = null;
                if (indicator) { indicator.classList.remove('show'); indicator.remove(); }
                if (placeholderIndex > -1 && placeholderIndex !== startIndex) {
                    opts?.onCommit?.(handleEl, placeholderIndex);
                }
            };

            // Pointer Events (covers mouse + touch)
            handleEl.style.touchAction = 'none';
            handleEl.addEventListener('pointerdown', onPointerDown);
            window.addEventListener('pointermove', onPointerMove);
            window.addEventListener('pointerup', onPointerUp);
        }

        // === Init ===
        function init() {
            load();
            if (state.lists.length === 0) {
                const sample = {
                    id: uid(), title: 'Getting started', tasks: [
                        { id: uid(), text: 'Add tasks using the input above', done: false },
                        { id: uid(), text: 'This is a task', done: false },
                        { id: uid(), text: 'Reorder me by dragging', done: false }
                    ]
                };
                const gift = { id: uid(), title: 'Gift ideas', tasks: [] };
                state.lists.push(sample, gift); state.activeId = sample.id; saveNow();
            }
            renderLists();
        }

        init();
    </script>
</body>

</html>

